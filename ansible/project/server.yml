---
- hosts: "{{ host | default('web') }}"
  become: yes
  gather_facts: no
  pre_tasks:
    - name: install python
      raw: |
        (/bin/env python3 -V || /bin/env python -V) || \
        (yum makecache -y && (yum install -y python3 || yum install -y python)) || \
        (apt update -y && (apt install -y python3 || apt install -y python))
    - name: get service facts
      service_facts:
      register: services
  roles:
    - role: services_prepare
      when: prepare_services is defined and prepare_services
    - role: scripts_sync
      when: sync_scripts is defined and sync_scripts
    - role: iptables_init
      when: init_iptables is defined and init_iptables
    - iptables_get
